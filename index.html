<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vegan Campsite Cookbook</title>
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Vegan Campsite">
    <link rel="apple-touch-icon" href="">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Ccircle cx='96' cy='96' r='80' fill='%2316a34a'/%3E%3Cpath d='M96 40 L96 100 M70 70 L96 100 L122 70' stroke='white' stroke-width='8' stroke-linecap='round' fill='none'/%3E%3C/svg%3E" sizes="any" type="image/svg+xml">
    
    <!-- Alpine.js for reactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                darkMode: 'class'
            }
        }
    </script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        [x-cloak] { display: none !important; }
        
        /* Dark mode transitions */
        * {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        
        /* Recipe card hover effects */
        .recipe-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .recipe-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body>
    <div x-data="cookbookApp()" x-init="init()" x-cloak :class="darkMode ? 'dark' : ''" class="min-h-screen bg-gradient-to-br from-green-50 to-orange-50 dark:from-gray-900 dark:to-gray-800 transition-colors duration-300">
        <div class="max-w-7xl mx-auto p-4 md:p-6">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6 transition-colors duration-300">
                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="text-center md:text-left">
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 dark:text-gray-100 mb-2">
                            <i class="bi bi-tree-fill text-green-600 dark:text-green-400"></i>
                            Vegan Campsite Cookbook
                        </h1>
                        <p class="text-gray-600 dark:text-gray-300">Plant-based recipes for outdoor adventures</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-center">
                            <div class="text-sm text-gray-500 dark:text-gray-400">Total Recipes</div>
                            <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="recipes.length"></div>
                        </div>
                        <button @click="toggleViewMode()" 
                                class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-300"
                                :title="viewMode === 'card' ? 'Switch to list view' : 'Switch to card view'">
                            <i x-show="viewMode === 'card'" class="bi bi-list-ul"></i>
                            <i x-show="viewMode === 'list'" class="bi bi-grid-3x3-gap"></i>
                        </button>
                        <button @click="toggleDarkMode()" 
                                class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-300">
                            <i x-show="!darkMode" class="bi bi-moon-stars"></i>
                            <i x-show="darkMode" class="bi bi-sun"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Search and Filters -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6 transition-colors duration-300">
                <div class="space-y-4">
                    <!-- Search Bar -->
                    <div class="relative">
                        <i class="bi bi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input x-model="searchTerm" 
                               type="text" 
                               placeholder="Search recipes, ingredients, or cuisines..."
                               class="w-full pl-10 pr-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 transition-colors duration-300">
                    </div>

                    <!-- Meal Filter Options -->
                    <div class="grid grid-cols-[auto_1fr] items-start mt-3">
                        <div class="text-sm text-gray-600 dark:text-gray-400 pt-1.5 w-20 pr-2">Meal:</div>
                        <div class="flex flex-wrap gap-2">
                        <button @click="mealFilter = 'all'"
                                :class="mealFilter === 'all' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            All
                        </button>
                        <button @click="mealFilter = 'breakfast'"
                                :class="mealFilter === 'breakfast' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-sunrise mr-1"></i>Breakfast
                        </button>
                        <button @click="mealFilter = 'lunch'"
                                :class="mealFilter === 'lunch' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-sun mr-1"></i>Lunch
                        </button>
                        <button @click="mealFilter = 'dinner'"
                                :class="mealFilter === 'dinner' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-moon-stars mr-1"></i>Dinner
                        </button>
                        <button @click="mealFilter = 'snack'"
                                :class="mealFilter === 'snack' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-cup-straw mr-1"></i>Snack
                        </button>
                        </div>
                    </div>
                    
                    <!-- Course Filter Options -->
                    <div class="grid grid-cols-[auto_1fr] items-start mt-3">
                        <div class="text-sm text-gray-600 dark:text-gray-400 pt-1.5 w-20 pr-2">Course:</div>
                        <div class="flex flex-wrap gap-2">
                        <button @click="courseFilter = 'all'"
                                :class="courseFilter === 'all' ? 'bg-orange-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            All
                        </button>
                        <button @click="courseFilter = 'appetizer'"
                                :class="courseFilter === 'appetizer' ? 'bg-orange-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-egg-fried mr-1"></i>Appetizer
                        </button>
                        <button @click="courseFilter = 'main'"
                                :class="courseFilter === 'main' ? 'bg-orange-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-bowl-hot-fill mr-1"></i>Main
                        </button>
                        <button @click="courseFilter = 'side'"
                                :class="courseFilter === 'side' ? 'bg-orange-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-egg mr-1"></i>Side
                        </button>
                        <button @click="courseFilter = 'dessert'"
                                :class="courseFilter === 'dessert' ? 'bg-orange-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-cake2 mr-1"></i>Dessert
                        </button>
                        </div>
                    </div>
                    
                    <!-- Type Filter Options -->
                    <div class="grid grid-cols-[auto_1fr] items-start mt-3">
                        <div class="text-sm text-gray-600 dark:text-gray-400 pt-1.5 w-20 pr-2">Type:</div>
                        <div class="flex flex-wrap gap-2">
                        <button @click="typeFilter = 'all'"
                                :class="typeFilter === 'all' ? 'bg-pink-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            All
                        </button>
                        <button @click="typeFilter = 'dip'"
                                :class="typeFilter === 'dip' ? 'bg-pink-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-droplet mr-1"></i>Dip
                        </button>
                        <button @click="typeFilter = 'casserole'"
                                :class="typeFilter === 'casserole' ? 'bg-pink-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-dish mr-1"></i>Casserole
                        </button>
                        <button @click="typeFilter = 'salad'"
                                :class="typeFilter === 'salad' ? 'bg-pink-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-flower2 mr-1"></i>Salad
                        </button>
                        <button @click="typeFilter = 'bread'"
                                :class="typeFilter === 'bread' ? 'bg-pink-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-basket mr-1"></i>Bread
                        </button>
                        <button @click="typeFilter = 'protein'"
                                :class="typeFilter === 'protein' ? 'bg-pink-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-lightning mr-1"></i>Protein
                        </button>
                        <button @click="typeFilter = 'grain'"
                                :class="typeFilter === 'grain' ? 'bg-pink-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-box mr-1"></i>Grain
                        </button>
                        <button @click="typeFilter = 'noodles'"
                                :class="typeFilter === 'noodles' ? 'bg-pink-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-bezier mr-1"></i>Noodles
                        </button>
                        <button @click="typeFilter = 'chili'"
                                :class="typeFilter === 'chili' ? 'bg-pink-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-fire mr-1"></i>Chili
                        </button>
                        </div>
                    </div>
                    
                    <!-- Dietary Filter Options -->
                    <div class="grid grid-cols-[auto_1fr] items-start mt-3">
                        <div class="text-sm text-gray-600 dark:text-gray-400 pt-1.5 w-20 pr-2">Dietary:</div>
                        <div class="flex flex-wrap gap-2">
                        <button @click="dietaryFilter = 'all'"
                                :class="dietaryFilter === 'all' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            All
                        </button>
                        <button @click="dietaryFilter = 'gluten-free'"
                                :class="dietaryFilter === 'gluten-free' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-shield-check mr-1"></i>Gluten-Free
                        </button>
                        <button @click="dietaryFilter = 'nut-free'"
                                :class="dietaryFilter === 'nut-free' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-x-circle mr-1"></i>Nut-Free
                        </button>
                        <button @click="dietaryFilter = 'soy-free'"
                                :class="dietaryFilter === 'soy-free' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-x-circle mr-1"></i>Soy-Free
                        </button>
                        </div>
                    </div>
                    
                    <!-- Cuisine Filter Options -->
                    <div class="grid grid-cols-[auto_1fr] items-start mt-3">
                        <div class="text-sm text-gray-600 dark:text-gray-400 pt-1.5 w-20 pr-2">Cuisine:</div>
                        <div class="flex flex-wrap gap-2">
                        <button @click="cuisineFilter = 'all'"
                                :class="cuisineFilter === 'all' ? 'bg-purple-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            All
                        </button>
                        <button @click="cuisineFilter = 'american'"
                                :class="cuisineFilter === 'american' ? 'bg-purple-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-flag mr-1"></i>American
                        </button>
                        <button @click="cuisineFilter = 'asian'"
                                :class="cuisineFilter === 'asian' ? 'bg-purple-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-globe-asia-australia mr-1"></i>Asian
                        </button>
                        <button @click="cuisineFilter = 'mexican'"
                                :class="cuisineFilter === 'mexican' ? 'bg-purple-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-emoji-smile mr-1"></i>Mexican
                        </button>
                        <button @click="cuisineFilter = 'middle-eastern'"
                                :class="cuisineFilter === 'middle-eastern' ? 'bg-purple-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-geo-alt mr-1"></i>Middle Eastern
                        </button>
                        <button @click="cuisineFilter = 'indian'"
                                :class="cuisineFilter === 'indian' ? 'bg-purple-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-stars mr-1"></i>Indian
                        </button>
                        </div>
                    </div>
                    
                    <!-- Verified Filter Options -->
                    <div class="grid grid-cols-[auto_1fr] items-start mt-3">
                        <div class="text-sm text-gray-600 dark:text-gray-400 pt-1.5 w-20 pr-2">Status:</div>
                        <div class="flex flex-wrap gap-2">
                        <button @click="verifiedFilter = 'all'"
                                :class="verifiedFilter === 'all' ? 'bg-teal-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            All
                        </button>
                        <button @click="verifiedFilter = 'verified'"
                                :class="verifiedFilter === 'verified' ? 'bg-teal-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-patch-check mr-1"></i>Verified
                        </button>
                        <button @click="verifiedFilter = 'unverified'"
                                :class="verifiedFilter === 'unverified' ? 'bg-teal-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-hourglass-split mr-1"></i>Unverified
                        </button>
                        </div>
                    </div>

                    <!-- Sorting and Grouping Options -->
                    <div class="flex flex-wrap gap-4 mt-3 pt-3 border-t border-gray-200 dark:border-gray-600">
                        <!-- Sort By Dropdown -->
                        <div class="flex items-center gap-2">
                            <label class="text-sm text-gray-600 dark:text-gray-400">
                                <i class="bi bi-sort-down mr-1"></i>Sort by:
                            </label>
                            <select x-model="sortBy" 
                                    @change="setSortBy(sortBy)"
                                    class="px-3 py-2 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-300">
                                <option value="alphabetical">Alphabetical</option>
                                <option value="date-added">Date Added</option>
                            </select>
                        </div>

                        <!-- Group By Dropdown -->
                        <div class="flex items-center gap-2">
                            <label class="text-sm text-gray-600 dark:text-gray-400">
                                <i class="bi bi-collection mr-1"></i>Group by:
                            </label>
                            <select x-model="groupBy" 
                                    @change="setGroupBy(groupBy)"
                                    class="px-3 py-2 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-300">
                                <option value="none">None</option>
                                <option value="cuisine">Cuisine</option>
                                <option value="meal">Meal</option>
                                <option value="course">Course</option>
                                <option value="type">Type</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div x-show="loading" class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"></div>
                <p class="mt-2 text-gray-600 dark:text-gray-400">Loading recipes...</p>
            </div>

            <!-- Recipe Grid (Card View) -->
            <div x-show="!loading && recipes.length > 0 && viewMode === 'card'" class="space-y-6">
                <template x-for="group in groupedRecipes" :key="group.group || 'none'">
                    <div>
                        <!-- Group Header -->
                        <h2 x-show="group.group" 
                            class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4 pb-2 border-b-2 border-green-500" 
                            x-text="group.group"></h2>
                        
                        <!-- Recipe Cards in Group -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <template x-for="recipe in group.recipes" :key="recipe.id">
                                <div class="recipe-card bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer transition-colors duration-300"
                                     @click="openRecipeModal(recipe)">
                                    <div class="p-6">
                                        <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-2" x-text="recipe.title"></h3>
                                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-2" x-text="recipe.description"></p>
                                        
                                        <div class="flex flex-wrap gap-2 mb-4">
                                            <span x-show="recipe.cuisine" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                                                <i class="bi bi-globe mr-1"></i>
                                                <span x-text="recipe.cuisine"></span>
                                            </span>
                                            <span x-show="recipe.preparationTime" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200">
                                                <i class="bi bi-clock mr-1"></i>
                                                <span x-text="recipe.preparationTime"></span>
                                            </span>
                                            <span x-show="recipe.servings" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200">
                                                <i class="bi bi-people mr-1"></i>
                                                <span x-text="recipe.servings"></span>
                                            </span>
                                        </div>

                                        <!-- Dietary Information -->
                                        <div x-show="recipe.dietaryInfo && recipe.dietaryInfo.length > 0" class="flex flex-wrap gap-1 mb-3">
                                            <template x-for="dietary in recipe.dietaryInfo" :key="dietary">
                                                <span class="text-xs px-2 py-1 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded-full border border-yellow-200 dark:border-yellow-700" x-text="dietary"></span>
                                            </template>
                                        </div>

                                        <div class="flex items-center justify-between">
                                            <div class="flex flex-wrap gap-1">
                                                <template x-for="course in recipe.courses" :key="course">
                                                    <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full" x-text="course"></span>
                                                </template>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <button @click="shareRecipe(recipe, $event)" 
                                                        class="text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 transition-colors"
                                                        title="Share recipe">
                                                    <i class="bi bi-share text-lg"></i>
                                                </button>
                                                <i class="bi bi-arrow-right-circle text-green-500 text-lg"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Recipe List (List View) -->
            <div x-show="!loading && recipes.length > 0 && viewMode === 'list'" class="space-y-6">
                <template x-for="group in groupedRecipes" :key="group.group || 'none'">
                    <div>
                        <!-- Group Header -->
                        <h2 x-show="group.group" 
                            class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4 pb-2 border-b-2 border-green-500" 
                            x-text="group.group"></h2>
                        
                        <!-- Recipe List in Group -->
                        <div class="space-y-3">
                            <template x-for="recipe in group.recipes" :key="recipe.id">
                                <div class="recipe-card bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer transition-colors duration-300"
                                     @click="openRecipeModal(recipe)">
                                    <div class="p-4 md:p-6">
                                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                            <!-- Title and Description -->
                                            <div class="flex-1 min-w-0">
                                                <h3 class="text-lg md:text-xl font-bold text-gray-800 dark:text-gray-100 mb-1" x-text="recipe.title"></h3>
                                                <p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-1" x-text="recipe.description"></p>
                                            </div>
                                            
                                            <!-- Metadata -->
                                            <div class="flex flex-wrap items-center gap-2 md:gap-3">
                                                <span x-show="recipe.cuisine" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 whitespace-nowrap">
                                                    <i class="bi bi-globe mr-1"></i>
                                                    <span x-text="recipe.cuisine"></span>
                                                </span>
                                                <span x-show="recipe.preparationTime" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 whitespace-nowrap">
                                                    <i class="bi bi-clock mr-1"></i>
                                                    <span x-text="recipe.preparationTime"></span>
                                                </span>
                                                <span x-show="recipe.servings" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 whitespace-nowrap">
                                                    <i class="bi bi-people mr-1"></i>
                                                    <span x-text="recipe.servings"></span>
                                                </span>
                                                <button @click="shareRecipe(recipe, $event)" 
                                                        class="text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 transition-colors"
                                                        title="Share recipe">
                                                    <i class="bi bi-share text-lg"></i>
                                                </button>
                                                <i class="bi bi-arrow-right-circle text-green-500 text-lg ml-2"></i>
                                            </div>
                                        </div>
                                        
                                        <!-- Tags Row -->
                                        <div class="flex flex-wrap gap-2 mt-3">
                                            <template x-for="course in recipe.courses" :key="course">
                                                <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full" x-text="course"></span>
                                            </template>
                                            <template x-for="dietary in recipe.dietaryInfo" :key="dietary">
                                                <span class="text-xs px-2 py-1 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded-full border border-yellow-200 dark:border-yellow-700" x-text="dietary"></span>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Empty State -->
            <div x-show="!loading && filteredRecipes.length === 0" class="text-center py-12">
                <i class="bi bi-search text-4xl text-gray-400 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">No recipes found</h3>
                <p class="text-gray-600 dark:text-gray-400">Try adjusting your search terms or filters</p>
            </div>

            <!-- Recipe Modal -->
            <div x-show="showRecipeModal" 
                 @click="closeRecipeModal()"
                 class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div @click.stop 
                     class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl" 
                     style="height: 80vh">
                    
                    <!-- Modal Header -->
                    <div class="bg-white dark:bg-gray-800 p-6 border-b border-gray-200 dark:border-gray-600 rounded-t-lg">
                        <div class="flex items-center justify-between">
                            <h2 x-show="selectedRecipe" class="text-2xl font-bold text-gray-800 dark:text-gray-100" x-text="selectedRecipe?.title"></h2>
                            <div class="flex items-center gap-3">
                                <button @click="shareRecipe(selectedRecipe, $event)" 
                                        x-show="selectedRecipe"
                                        class="text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 transition-colors text-xl"
                                        title="Share recipe">
                                    <i class="bi bi-share"></i>
                                </button>
                                <button @click="closeRecipeModal()" 
                                        class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modal Content -->
                    <div class="bg-gray-50 dark:bg-gray-900 p-6 overflow-y-scroll" 
                         style="height: calc(80vh - 120px)">
                        <template x-if="selectedRecipe">
                            <div class="space-y-6">
                                <!-- Recipe Info -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div x-show="selectedRecipe.cuisine" class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Cuisine</div>
                                        <div class="font-semibold text-gray-800 dark:text-gray-200" x-text="selectedRecipe.cuisine"></div>
                                    </div>
                                    <div x-show="selectedRecipe.preparationTime" class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Prep Time</div>
                                        <div class="font-semibold text-gray-800 dark:text-gray-200" x-text="selectedRecipe.preparationTime"></div>
                                    </div>
                                    <div x-show="selectedRecipe.servings" class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Servings</div>
                                        <div class="font-semibold text-gray-800 dark:text-gray-200" x-text="selectedRecipe.servings"></div>
                                    </div>
                                    <div x-show="selectedRecipe.dateAdded" class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Date Added</div>
                                        <div class="font-semibold text-gray-800 dark:text-gray-200" x-text="selectedRecipe.dateAdded"></div>
                                    </div>
                                </div>

                                <!-- Description -->
                                <div x-show="selectedRecipe.description" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Description</h3>
                                    <p class="text-gray-600 dark:text-gray-400" x-text="selectedRecipe.description"></p>
                                </div>

                                <!-- Dietary Information -->
                                <div x-show="selectedRecipe.dietaryInfo && selectedRecipe.dietaryInfo.length > 0" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                                        <i class="bi bi-shield-check mr-2"></i>Dietary Information
                                    </h3>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="dietary in selectedRecipe.dietaryInfo" :key="dietary">
                                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700" x-text="dietary"></span>
                                        </template>
                                    </div>
                                </div>

                                <!-- Ingredients -->
                                <div x-show="selectedRecipe.ingredients" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                                        <i class="bi bi-list-ul mr-2"></i>Ingredients
                                    </h3>
                                    <div x-html="selectedRecipe.ingredients" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                </div>

                                <!-- Steps -->
                                <div x-show="selectedRecipe.steps" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                                        <i class="bi bi-list-ol mr-2"></i>Instructions
                                    </h3>
                                    <div x-html="selectedRecipe.steps" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                </div>

                                <!-- Additional Info -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div x-show="selectedRecipe.servingGuidelines" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Serving Guidelines</h3>
                                        <div x-html="selectedRecipe.servingGuidelines" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                    </div>
                                    <div x-show="selectedRecipe.notes" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Notes</h3>
                                        <div x-html="selectedRecipe.notes" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                    </div>
                                </div>

                                <!-- Source -->
                                <div x-show="selectedRecipe.source" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Source</h3>
                                    <div x-html="selectedRecipe.source" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Copy Success Feedback Toast -->
            <div x-show="showCopyFeedback" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0"
                 x-transition:leave-end="opacity-0 translate-y-4"
                 class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50">
                <i class="bi bi-check-circle-fill"></i>
                <span>Recipe link copied to clipboard!</span>
            </div>
        </div>
    </div>

    <script>
        // === PWA FUNCTIONALITY ===
        // Install prompt listener
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA install prompt available!');
        });

        const iconSize = 192;

        // Dynamically created manifest
        const manifest = {
            name: 'Vegan Campsite Cookbook',
            short_name: 'Vegan Campsite',
            description: 'Plant-based recipes for outdoor adventures',
            display: 'standalone',
            theme_color: '#16a34a',
            background_color: '#f0fdf4',
            start_url: window.location.href,
        };

        // Convert the SVG favicon to PNG for platforms that don't support SVG
        // (Safari and Firefox on Android)
        (async function initPWA() {
            const svgIconLink = document.querySelector('link[rel="icon"]');

            // Convert from SVG string to PNG data URL
            const pngDataUrl = await svgToPng(svgIconLink.href, iconSize);

            // Set the icon meta tags to the new PNG
            setIcon("link[rel='icon']", pngDataUrl, iconSize);
            setIcon("link[rel='apple-touch-icon']", pngDataUrl);

            // Dynamically create manifest with PNG icon
            manifest.icons = [{
                src: pngDataUrl,
                sizes: `${iconSize}x${iconSize}`,
                type: 'image/png'
            }];

            // Set the manifest meta tag data url
            setManifest(manifest);

            // Generate and set the iOS startup image
            const startupImageDataUrl = await createStartupImage(
                svgIconLink.href,
                manifest.background_color
            );
            const startupLink = document.createElement('link');
            startupLink.rel = 'apple-touch-startup-image';
            startupLink.href = startupImageDataUrl;
            document.head.appendChild(startupLink);
        })();

        function setManifest(manifest) {
            const link = document.createElement('link');
            link.rel = 'manifest';
            const b64manifest = btoa(JSON.stringify(manifest));
            link.href = "data:application/json;base64," + b64manifest;
            document.head.appendChild(link);
        }

        function setIcon(query, iconurl, size) {
            const iconLink = document.querySelector(query);
            iconLink.href = iconurl;
            iconLink.type = 'image/png';
            if (size) {
                iconLink.setAttribute('sizes', `${size}x${size}`);
            }
        }

        function svgToPng(svgDataUrl, size) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    canvas.width = size;
                    canvas.height = size;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, size, size);
                    const pngDataUrl = canvas.toDataURL('image/png');
                    resolve(pngDataUrl);
                };
                img.onerror = reject;
                img.src = svgDataUrl;
            });
        }

        // Safari needs a startup image
        function createStartupImage(svgDataUrl, bgColor) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    const dpr = window.devicePixelRatio || 1;
                    const canvas = document.createElement('canvas');
                    canvas.width = window.screen.width * dpr;
                    canvas.height = window.screen.height * dpr;
                    const ctx = canvas.getContext('2d');

                    ctx.fillStyle = bgColor;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    const iconDisplaySize = canvas.width * 0.25;
                    const x = (canvas.width - iconDisplaySize) / 2;
                    const y = (canvas.height - iconDisplaySize) / 2;
                    ctx.drawImage(img, x, y, iconDisplaySize, iconDisplaySize);

                    resolve(canvas.toDataURL('image/png'));
                };
                img.onerror = reject;
                img.src = svgDataUrl;
            });
        }

        // === ALPINE.JS APP ===
        function cookbookApp() {
            return {
                // === STATE ===
                recipes: [],
                searchTerm: '',
                mealFilter: 'all', // 'all', 'breakfast', 'lunch', 'dinner', 'snack'
                courseFilter: 'all', // 'all', 'appetizer', 'main', 'side', 'dessert'
                typeFilter: 'all', // 'all', 'dip', 'casserole', 'salad', 'bread', 'protein', 'grain', 'noodles', 'chili'
                dietaryFilter: 'all', // 'all', 'gluten-free', 'nut-free', 'soy-free'
                cuisineFilter: 'all', // 'all', 'american', 'asian', 'mexican', 'middle-eastern', 'indian'
                verifiedFilter: 'all', // 'all', 'verified', 'unverified'
                loading: true,
                darkMode: false,
                viewMode: 'card', // 'card' or 'list'
                showRecipeModal: false,
                selectedRecipe: null,
                groupBy: 'cuisine', // 'none', 'cuisine', 'meal', 'course', 'type'
                sortBy: 'alphabetical', // 'alphabetical', 'date-added'
                showCopyFeedback: false, // Show feedback when recipe link is copied

                // === COMPUTED PROPERTIES ===
                get filteredRecipes() {
                    let filtered = this.recipes;
                    
                    // Apply search filter
                    if (this.searchTerm) {
                        const searchLower = this.searchTerm.toLowerCase();
                        filtered = filtered.filter(recipe => 
                            recipe.title.toLowerCase().includes(searchLower) ||
                            recipe.description.toLowerCase().includes(searchLower) ||
                            (recipe.cuisine && recipe.cuisine.toLowerCase().includes(searchLower)) ||
                            (recipe.ingredients && recipe.ingredients.toLowerCase().includes(searchLower)) ||
                            (recipe.dietaryInfo && recipe.dietaryInfo.some(info => 
                                info.toLowerCase().includes(searchLower)
                            ))
                        );
                    }
                    
                    // Apply meal filter
                    if (this.mealFilter !== 'all') {
                        filtered = filtered.filter(recipe => {
                            switch (this.mealFilter) {
                                case 'breakfast':
                                    return recipe.meal && recipe.meal.toLowerCase().includes('breakfast');
                                case 'lunch':
                                    return recipe.meal && recipe.meal.toLowerCase().includes('lunch');
                                case 'dinner':
                                    return recipe.meal && recipe.meal.toLowerCase().includes('dinner');
                                case 'snack':
                                    return recipe.meal && recipe.meal.toLowerCase().includes('snack');
                                default:
                                    return true;
                            }
                        });
                    }
                    
                    // Apply course filter
                    if (this.courseFilter !== 'all') {
                        filtered = filtered.filter(recipe => {
                            if (!recipe.courses || recipe.courses.length === 0) return false;
                            return recipe.courses.some(course => {
                                const courseLower = course.toLowerCase();
                                switch (this.courseFilter) {
                                    case 'appetizer':
                                        return courseLower.includes('appetizer');
                                    case 'main':
                                        return courseLower.includes('main');
                                    case 'side':
                                        return courseLower.includes('side');
                                    case 'dessert':
                                        return courseLower.includes('dessert');
                                    default:
                                        return true;
                                }
                            });
                        });
                    }
                    
                    // Apply type filter
                    if (this.typeFilter !== 'all') {
                        filtered = filtered.filter(recipe => {
                            if (!recipe.type) return false;
                            const typeLower = recipe.type.toLowerCase();
                            switch (this.typeFilter) {
                                case 'dip':
                                    return typeLower.includes('dip');
                                case 'casserole':
                                    return typeLower.includes('casserole') || typeLower.includes('pasta');
                                case 'salad':
                                    return typeLower.includes('salad');
                                case 'bread':
                                    return typeLower.includes('bread') || typeLower.includes('muffin');
                                case 'protein':
                                    return typeLower.includes('protein') || typeLower.includes('scramble') || typeLower.includes('omelet');
                                case 'grain':
                                    return typeLower.includes('grain') || typeLower.includes('rice');
                                case 'noodles':
                                    return typeLower.includes('noodles');
                                case 'chili':
                                    return typeLower.includes('chili') || typeLower.includes('stew');
                                default:
                                    return true;
                            }
                        });
                    }
                    
                    // Apply dietary filter
                    if (this.dietaryFilter !== 'all') {
                        filtered = filtered.filter(recipe => {
                            switch (this.dietaryFilter) {
                                case 'gluten-free':
                                    return recipe.dietaryInfo && recipe.dietaryInfo.some(info => 
                                        info.toLowerCase().includes('gluten-free')
                                    ) && !recipe.dietaryInfo.some(info => 
                                        info.toLowerCase().includes('may contain gluten') || 
                                        info.toLowerCase().includes('contains gluten')
                                    );
                                case 'nut-free':
                                    return recipe.dietaryInfo && !recipe.dietaryInfo.some(info => 
                                        info.toLowerCase().includes('nuts') || 
                                        info.toLowerCase().includes('cashew') ||
                                        info.toLowerCase().includes('almond') ||
                                        info.toLowerCase().includes('peanut')
                                    );
                                case 'soy-free':
                                    return recipe.dietaryInfo && !recipe.dietaryInfo.some(info => 
                                        info.toLowerCase().includes('soy')
                                    );
                                default:
                                    return true;
                            }
                        });
                    }
                    
                    // Apply cuisine filter
                    if (this.cuisineFilter !== 'all') {
                        filtered = filtered.filter(recipe => {
                            if (!recipe.cuisine) return false;
                            const cuisineLower = recipe.cuisine.toLowerCase();
                            switch (this.cuisineFilter) {
                                case 'american':
                                    return cuisineLower.includes('american');
                                case 'asian':
                                    return cuisineLower.includes('asian');
                                case 'mexican':
                                    return cuisineLower.includes('mexican') || cuisineLower.includes('tex-mex');
                                case 'middle-eastern':
                                    return cuisineLower.includes('middle eastern');
                                case 'indian':
                                    return cuisineLower.includes('indian');
                                default:
                                    return true;
                            }
                        });
                    }
                    
                    // Apply verified filter
                    if (this.verifiedFilter !== 'all') {
                        filtered = filtered.filter(recipe => {
                            if (!recipe.verified) return false;
                            const verifiedLower = recipe.verified.toLowerCase();
                            switch (this.verifiedFilter) {
                                case 'verified':
                                    return verifiedLower.includes('verified') && !verifiedLower.includes('unverified');
                                case 'unverified':
                                    return verifiedLower.includes('unverified');
                                default:
                                    return true;
                            }
                        });
                    }
                    
                    // Apply sorting
                    filtered = this.sortRecipes(filtered);
                    
                    return filtered;
                },

                get groupedRecipes() {
                    const recipes = this.filteredRecipes;
                    
                    if (this.groupBy === 'none') {
                        return [{ group: null, recipes: recipes }];
                    }
                    
                    const groups = {};
                    
                    recipes.forEach(recipe => {
                        let groupKeys = [];
                        
                        switch (this.groupBy) {
                            case 'cuisine':
                                groupKeys = [recipe.cuisine || 'Other'];
                                break;
                            case 'meal':
                                groupKeys = [recipe.meal || 'Other'];
                                break;
                            case 'course':
                                groupKeys = recipe.courses && recipe.courses.length > 0 
                                    ? recipe.courses 
                                    : ['Other'];
                                break;
                            case 'type':
                                groupKeys = [recipe.type || 'Other'];
                                break;
                        }
                        
                        groupKeys.forEach(key => {
                            if (!groups[key]) {
                                groups[key] = [];
                            }
                            groups[key].push(recipe);
                        });
                    });
                    
                    // Convert to array and sort group names
                    return Object.keys(groups)
                        .sort((a, b) => a.localeCompare(b))
                        .map(group => ({
                            group: group,
                            recipes: groups[group]
                        }));
                },

                // === METHODS ===
                async init() {
                    // Load dark mode preference
                    const savedDarkMode = localStorage.getItem('cookbook-darkMode');
                    this.darkMode = savedDarkMode === 'true';
                    this.updateDarkMode();
                    
                    // Load view mode preference
                    const savedViewMode = localStorage.getItem('cookbook-viewMode');
                    this.viewMode = savedViewMode || 'card';
                    
                    // Load grouping preference
                    const savedGroupBy = localStorage.getItem('cookbook-groupBy');
                    this.groupBy = savedGroupBy || 'cuisine';
                    
                    // Load sorting preference
                    const savedSortBy = localStorage.getItem('cookbook-sortBy');
                    this.sortBy = savedSortBy || 'alphabetical';
                    
                    // Load recipes
                    await this.loadRecipes();
                    
                    // Check for recipe URL parameter and open if found
                    this.checkRecipeUrlParameter();
                },

                async loadRecipes() {
                    this.loading = true;
                    try {
                        // Load recipe file list from manifest
                        let recipeFiles = [];
                        try {
                            const manifestResponse = await fetch('recipes.json');
                            if (manifestResponse.ok) {
                                recipeFiles = await manifestResponse.json();
                            }
                        } catch (error) {
                            console.warn('Could not load recipe manifest, using fallback list:', error);
                            // Fallback to known recipe files if manifest fails
                            recipeFiles = [
                                'hummus-moosewood.md',
                                'chili-fire-roasted.md',
                                'peanut-sesame-noodles.md'
                            ];
                        }
                        
                        const recipePromises = recipeFiles.map(async (filename) => {
                            try {
                                const response = await fetch(`recipes/${filename}`);
                                if (response.ok) {
                                    const content = await response.text();
                                    return this.parseRecipe(content, filename);
                                }
                                return null;
                            } catch (error) {
                                console.error(`Error loading ${filename}:`, error);
                                return null;
                            }
                        });
                        
                        const results = await Promise.all(recipePromises);
                        this.recipes = results.filter(recipe => recipe !== null);
                        
                        // If no recipes loaded from files, add sample data
                        if (this.recipes.length === 0) {
                            this.addSampleRecipes();
                        }
                        
                    } catch (error) {
                        console.error('Error loading recipes:', error);
                        // Add sample data if loading fails
                        this.addSampleRecipes();
                    }
                    this.loading = false;
                },

                parseRecipe(content, filename) {
                    const lines = content.split('\n');
                    const recipe = {
                        id: filename.replace('.md', ''),
                        title: '',
                        description: '',
                        dietaryInfo: [],
                        cuisine: '',
                        meal: '',
                        courses: [],
                        type: '',
                        preparationTime: '',
                        servings: '',
                        ingredients: '',
                        steps: '',
                        servingGuidelines: '',
                        notes: '',
                        source: '',
                        dateAdded: '',
                        verified: ''
                    };

                    let currentSection = '';
                    let sectionContent = [];

                    for (let line of lines) {
                        line = line.trim();
                        
                        // Handle title
                        if (line.startsWith('# ') && !recipe.title) {
                            recipe.title = line.substring(2).trim();
                            continue;
                        }

                        // Handle sections
                        if (line.startsWith('## ')) {
                            // Save previous section
                            if (currentSection && sectionContent.length > 0) {
                                this.assignSectionContent(recipe, currentSection, sectionContent);
                            }
                            
                            currentSection = line.substring(3).trim().toLowerCase();
                            sectionContent = [];
                            continue;
                        }

                        // Collect content for current section
                        if (currentSection && line) {
                            sectionContent.push(line);
                        }
                    }

                    // Handle final section
                    if (currentSection && sectionContent.length > 0) {
                        this.assignSectionContent(recipe, currentSection, sectionContent);
                    }

                    return recipe;
                },

                assignSectionContent(recipe, section, content) {
                    const contentText = content.join('\n');
                    
                    switch (section) {
                        case 'description':
                            recipe.description = contentText;
                            break;
                        case 'date added':
                            recipe.dateAdded = contentText.replace(/^-\s*/, '').trim();
                            break;
                        case 'verified':
                            recipe.verified = contentText.replace(/^-\s*/, '').trim();
                            break;
                        case 'dietary information':
                            recipe.dietaryInfo = contentText.split('\n').map(d => d.replace(/^-\s*/, '').trim()).filter(d => d);
                            break;
                        case 'cuisine':
                            recipe.cuisine = contentText.replace(/^-\s*/, '');
                            break;
                        case 'meal':
                            recipe.meal = contentText.replace(/^-\s*/, '');
                            break;
                        case 'course':
                            recipe.courses = contentText.split('\n').map(c => c.replace(/^-\s*/, '').trim()).filter(c => c);
                            break;
                        case 'type':
                            recipe.type = contentText.replace(/^-\s*/, '');
                            break;
                        case 'preparation time':
                            recipe.preparationTime = contentText.replace(/^-\s*/, '');
                            break;
                        case 'servings':
                            recipe.servings = contentText.replace(/^-\s*/, '');
                            break;
                        case 'ingredients':
                            recipe.ingredients = this.markdownToHtml(contentText);
                            break;
                        case 'steps':
                            recipe.steps = this.markdownToHtml(contentText);
                            break;
                        case 'serving guidelines':
                            recipe.servingGuidelines = this.markdownToHtml(contentText);
                            break;
                        case 'notes':
                            recipe.notes = this.markdownToHtml(contentText);
                            break;
                        case 'source / inspiration':
                            recipe.source = this.markdownToHtml(contentText);
                            break;
                    }
                },

                markdownToHtml(text) {
                    return text
                        .replace(/^### (.*$)/gm, '<h4 class="font-semibold text-gray-800 dark:text-gray-200 mt-4 mb-2">$1</h4>')
                        .replace(/^- (.*$)/gm, '<li class="mb-1">$1</li>')
                        .replace(/^(\d+)\. (.*$)/gm, '<li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">$1.</span> $2</li>')
                        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" class="text-blue-600 dark:text-blue-400 underline hover:text-blue-800 dark:hover:text-blue-200" target="_blank" rel="noopener">$1</a>')
                        .replace(/(?:^- .*$\n?)+/gm, (match) => `<ul class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-200">${match}</ul>`)
                        .replace(/(?:^\d+\. .*$\n?)+/gm, (match) => `<ol class="space-y-2 text-gray-700 dark:text-gray-200">${match}</ol>`);
                },

                addSampleRecipes() {
                    this.recipes = [
                        {
                            id: 'sample-hummus',
                            title: 'Classic Hummus',
                            description: 'A creamy, delicious chickpea dip perfect for camping.',
                            dietaryInfo: ['Vegan', 'Gluten-Free', 'Contains Sesame'],
                            cuisine: 'Middle Eastern',
                            courses: ['Appetizer', 'Side'],
                            preparationTime: '15 minutes',
                            servings: '4 servings',
                            ingredients: '<ul class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-200"><li class="mb-1">1 can chickpeas</li><li class="mb-1">2 cloves garlic</li><li class="mb-1">2 tbsp tahini</li><li class="mb-1">Lemon juice</li></ul>',
                            steps: '<ol class="space-y-2 text-gray-700 dark:text-gray-200"><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">1.</span> Drain chickpeas</li><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">2.</span> Blend all ingredients</li><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">3.</span> Serve with pita</li></ol>'
                        },
                        {
                            id: 'sample-chili',
                            title: 'Campfire Black Bean Chili',
                            description: 'A hearty, warming chili perfect for cold camping nights.',
                            dietaryInfo: ['Vegan', 'Gluten-Free'],
                            cuisine: 'American',
                            courses: ['Main'],
                            preparationTime: '45 minutes',
                            servings: '6 servings',
                            ingredients: '<ul class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-200"><li class="mb-1">2 cans black beans</li><li class="mb-1">1 can diced tomatoes</li><li class="mb-1">Chili spices</li><li class="mb-1">Vegetables</li></ul>',
                            steps: '<ol class="space-y-2 text-gray-700 dark:text-gray-200"><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">1.</span> Saut vegetables</li><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">2.</span> Add beans and tomatoes</li><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">3.</span> Simmer 30 minutes</li></ol>'
                        }
                    ];
                },

                sortRecipes(recipes) {
                    const sorted = [...recipes];
                    
                    switch (this.sortBy) {
                        case 'alphabetical':
                            return sorted.sort((a, b) => a.title.localeCompare(b.title));
                        case 'date-added':
                            return sorted.sort((a, b) => {
                                // Parse dates in YYYY.MM.DD format
                                const dateA = a.dateAdded ? new Date(a.dateAdded.replace(/\./g, '-')) : new Date(0);
                                const dateB = b.dateAdded ? new Date(b.dateAdded.replace(/\./g, '-')) : new Date(0);
                                return dateB - dateA; // Most recent first
                            });
                        default:
                            return sorted;
                    }
                },

                openRecipeModal(recipe) {
                    this.selectedRecipe = recipe;
                    this.showRecipeModal = true;
                    // Update URL with recipe parameter
                    this.updateUrlParameter(recipe.id);
                },
                
                closeRecipeModal() {
                    this.showRecipeModal = false;
                    this.selectedRecipe = null;
                    // Clear URL parameter when closing modal
                    this.clearUrlParameter();
                },
                
                checkRecipeUrlParameter() {
                    // Check if there's a recipe parameter in the URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const recipeId = urlParams.get('recipe');
                    
                    if (recipeId) {
                        // Find and open the recipe
                        const recipe = this.recipes.find(r => r.id === recipeId);
                        if (recipe) {
                            this.openRecipeModal(recipe);
                        }
                    }
                },
                
                updateUrlParameter(recipeId) {
                    // Update URL without reloading the page
                    const url = new URL(window.location);
                    url.searchParams.set('recipe', recipeId);
                    window.history.pushState({}, '', url);
                },
                
                clearUrlParameter() {
                    // Remove recipe parameter from URL
                    const url = new URL(window.location);
                    url.searchParams.delete('recipe');
                    window.history.pushState({}, '', url);
                },

                shareRecipe(recipe, event) {
                    // Stop event propagation to prevent opening modal when clicking share button
                    if (event) {
                        event.stopPropagation();
                    }
                    
                    // Build the shareable URL
                    const url = new URL(window.location.origin + window.location.pathname);
                    url.searchParams.set('recipe', recipe.id);
                    const shareUrl = url.toString();
                    
                    // Copy to clipboard
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        // Show feedback
                        this.showCopyFeedback = true;
                        setTimeout(() => {
                            this.showCopyFeedback = false;
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy URL:', err);
                        // Fallback: show alert with URL
                        alert('Share this recipe:\n' + shareUrl);
                    });
                },

                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    this.updateDarkMode();
                    localStorage.setItem('cookbook-darkMode', this.darkMode.toString());
                },

                toggleViewMode() {
                    this.viewMode = this.viewMode === 'card' ? 'list' : 'card';
                    localStorage.setItem('cookbook-viewMode', this.viewMode);
                },

                setGroupBy(value) {
                    this.groupBy = value;
                    localStorage.setItem('cookbook-groupBy', value);
                },

                setSortBy(value) {
                    this.sortBy = value;
                    localStorage.setItem('cookbook-sortBy', value);
                },

                updateDarkMode() {
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }
            }
        }
    </script>
</body>
</html>
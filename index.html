<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vegan Campsite Cookbook</title>
    
    <!-- Alpine.js for reactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                darkMode: 'class'
            }
        }
    </script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        [x-cloak] { display: none !important; }
        
        /* Dark mode transitions */
        * {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        
        /* Recipe card hover effects */
        .recipe-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .recipe-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body>
    <div x-data="cookbookApp()" x-init="init()" x-cloak :class="darkMode ? 'dark' : ''" class="min-h-screen bg-gradient-to-br from-green-50 to-orange-50 dark:from-gray-900 dark:to-gray-800 transition-colors duration-300">
        <div class="max-w-7xl mx-auto p-4 md:p-6">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6 transition-colors duration-300">
                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="text-center md:text-left">
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 dark:text-gray-100 mb-2">
                            <i class="bi bi-tree-fill text-green-600 dark:text-green-400"></i>
                            Vegan Campsite Cookbook
                        </h1>
                        <p class="text-gray-600 dark:text-gray-300">Plant-based recipes for outdoor adventures</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-center">
                            <div class="text-sm text-gray-500 dark:text-gray-400">Total Recipes</div>
                            <div class="text-2xl font-bold text-green-600 dark:text-green-400" x-text="recipes.length"></div>
                        </div>
                        <button @click="toggleViewMode()" 
                                class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-300"
                                :title="viewMode === 'card' ? 'Switch to list view' : 'Switch to card view'">
                            <i x-show="viewMode === 'card'" class="bi bi-list-ul"></i>
                            <i x-show="viewMode === 'list'" class="bi bi-grid-3x3-gap"></i>
                        </button>
                        <button @click="toggleDarkMode()" 
                                class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-300">
                            <i x-show="!darkMode" class="bi bi-moon-stars"></i>
                            <i x-show="darkMode" class="bi bi-sun"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Search and Filters -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6 transition-colors duration-300">
                <div class="space-y-4">
                    <!-- Search Bar -->
                    <div class="relative">
                        <i class="bi bi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input x-model="searchTerm" 
                               type="text" 
                               placeholder="Search recipes, ingredients, or cuisines..."
                               class="w-full pl-10 pr-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 transition-colors duration-300">
                    </div>

                    <!-- Filter Options -->
                    <div class="flex flex-wrap gap-2">
                        <button @click="activeFilter = 'all'"
                                :class="activeFilter === 'all' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-4 py-2 rounded-lg font-medium transition-colors duration-300">
                            All Recipes
                        </button>
                        <button @click="activeFilter = 'appetizer'"
                                :class="activeFilter === 'appetizer' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-4 py-2 rounded-lg font-medium transition-colors duration-300">
                            <i class="bi bi-egg-fried mr-1"></i>Appetizers
                        </button>
                        <button @click="activeFilter = 'main'"
                                :class="activeFilter === 'main' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-4 py-2 rounded-lg font-medium transition-colors duration-300">
                            <i class="bi bi-bowl-hot mr-1"></i>Main Dishes
                        </button>
                        <button @click="activeFilter = 'quick'"
                                :class="activeFilter === 'quick' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'" 
                                class="px-4 py-2 rounded-lg font-medium transition-colors duration-300">
                            <i class="bi bi-clock mr-1"></i>Quick (< 30min)
                        </button>
                    </div>
                    
                    <!-- Dietary Filter Options -->
                    <div class="flex flex-wrap gap-2 mt-3">
                        <div class="text-sm text-gray-600 dark:text-gray-400 mr-2 self-center">Dietary:</div>
                        <button @click="activeFilter = 'gluten-free'"
                                :class="activeFilter === 'gluten-free' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-shield-check mr-1"></i>Gluten-Free
                        </button>
                        <button @click="activeFilter = 'nut-free'"
                                :class="activeFilter === 'nut-free' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-x-circle mr-1"></i>Nut-Free
                        </button>
                        <button @click="activeFilter = 'soy-free'"
                                :class="activeFilter === 'soy-free' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300'"
                                class="px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-300">
                            <i class="bi bi-x-circle mr-1"></i>Soy-Free
                        </button>
                    </div>

                    <!-- Sorting and Grouping Options -->
                    <div class="flex flex-wrap gap-4 mt-3 pt-3 border-t border-gray-200 dark:border-gray-600">
                        <!-- Sort By Dropdown -->
                        <div class="flex items-center gap-2">
                            <label class="text-sm text-gray-600 dark:text-gray-400">
                                <i class="bi bi-sort-down mr-1"></i>Sort by:
                            </label>
                            <select x-model="sortBy" 
                                    @change="setSortBy(sortBy)"
                                    class="px-3 py-2 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-300">
                                <option value="alphabetical">Alphabetical</option>
                                <option value="date-added">Date Added</option>
                            </select>
                        </div>

                        <!-- Group By Dropdown -->
                        <div class="flex items-center gap-2">
                            <label class="text-sm text-gray-600 dark:text-gray-400">
                                <i class="bi bi-collection mr-1"></i>Group by:
                            </label>
                            <select x-model="groupBy" 
                                    @change="setGroupBy(groupBy)"
                                    class="px-3 py-2 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-300">
                                <option value="none">None</option>
                                <option value="cuisine">Cuisine</option>
                                <option value="meal">Meal</option>
                                <option value="course">Course</option>
                                <option value="type">Type</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div x-show="loading" class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"></div>
                <p class="mt-2 text-gray-600 dark:text-gray-400">Loading recipes...</p>
            </div>

            <!-- Recipe Grid (Card View) -->
            <div x-show="!loading && recipes.length > 0 && viewMode === 'card'" class="space-y-6">
                <template x-for="group in groupedRecipes" :key="group.group || 'none'">
                    <div>
                        <!-- Group Header -->
                        <h2 x-show="group.group" 
                            class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4 pb-2 border-b-2 border-green-500" 
                            x-text="group.group"></h2>
                        
                        <!-- Recipe Cards in Group -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <template x-for="recipe in group.recipes" :key="recipe.id">
                                <div class="recipe-card bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer transition-colors duration-300"
                                     @click="openRecipeModal(recipe)">
                                    <div class="p-6">
                                        <h3 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-2" x-text="recipe.title"></h3>
                                        <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-2" x-text="recipe.description"></p>
                                        
                                        <div class="flex flex-wrap gap-2 mb-4">
                                            <span x-show="recipe.cuisine" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                                                <i class="bi bi-globe mr-1"></i>
                                                <span x-text="recipe.cuisine"></span>
                                            </span>
                                            <span x-show="recipe.preparationTime" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200">
                                                <i class="bi bi-clock mr-1"></i>
                                                <span x-text="recipe.preparationTime"></span>
                                            </span>
                                            <span x-show="recipe.servings" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200">
                                                <i class="bi bi-people mr-1"></i>
                                                <span x-text="recipe.servings"></span>
                                            </span>
                                        </div>

                                        <!-- Dietary Information -->
                                        <div x-show="recipe.dietaryInfo && recipe.dietaryInfo.length > 0" class="flex flex-wrap gap-1 mb-3">
                                            <template x-for="dietary in recipe.dietaryInfo" :key="dietary">
                                                <span class="text-xs px-2 py-1 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded-full border border-yellow-200 dark:border-yellow-700" x-text="dietary"></span>
                                            </template>
                                        </div>

                                        <div class="flex items-center justify-between">
                                            <div class="flex flex-wrap gap-1">
                                                <template x-for="course in recipe.courses" :key="course">
                                                    <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full" x-text="course"></span>
                                                </template>
                                            </div>
                                            <i class="bi bi-arrow-right-circle text-green-500 text-lg"></i>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Recipe List (List View) -->
            <div x-show="!loading && recipes.length > 0 && viewMode === 'list'" class="space-y-6">
                <template x-for="group in groupedRecipes" :key="group.group || 'none'">
                    <div>
                        <!-- Group Header -->
                        <h2 x-show="group.group" 
                            class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4 pb-2 border-b-2 border-green-500" 
                            x-text="group.group"></h2>
                        
                        <!-- Recipe List in Group -->
                        <div class="space-y-3">
                            <template x-for="recipe in group.recipes" :key="recipe.id">
                                <div class="recipe-card bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer transition-colors duration-300"
                                     @click="openRecipeModal(recipe)">
                                    <div class="p-4 md:p-6">
                                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                            <!-- Title and Description -->
                                            <div class="flex-1 min-w-0">
                                                <h3 class="text-lg md:text-xl font-bold text-gray-800 dark:text-gray-100 mb-1" x-text="recipe.title"></h3>
                                                <p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-1" x-text="recipe.description"></p>
                                            </div>
                                            
                                            <!-- Metadata -->
                                            <div class="flex flex-wrap items-center gap-2 md:gap-3">
                                                <span x-show="recipe.cuisine" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 whitespace-nowrap">
                                                    <i class="bi bi-globe mr-1"></i>
                                                    <span x-text="recipe.cuisine"></span>
                                                </span>
                                                <span x-show="recipe.preparationTime" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 whitespace-nowrap">
                                                    <i class="bi bi-clock mr-1"></i>
                                                    <span x-text="recipe.preparationTime"></span>
                                                </span>
                                                <span x-show="recipe.servings" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 whitespace-nowrap">
                                                    <i class="bi bi-people mr-1"></i>
                                                    <span x-text="recipe.servings"></span>
                                                </span>
                                                <i class="bi bi-arrow-right-circle text-green-500 text-lg ml-2"></i>
                                            </div>
                                        </div>
                                        
                                        <!-- Tags Row -->
                                        <div class="flex flex-wrap gap-2 mt-3">
                                            <template x-for="course in recipe.courses" :key="course">
                                                <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full" x-text="course"></span>
                                            </template>
                                            <template x-for="dietary in recipe.dietaryInfo" :key="dietary">
                                                <span class="text-xs px-2 py-1 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 rounded-full border border-yellow-200 dark:border-yellow-700" x-text="dietary"></span>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Empty State -->
            <div x-show="!loading && filteredRecipes.length === 0" class="text-center py-12">
                <i class="bi bi-search text-4xl text-gray-400 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">No recipes found</h3>
                <p class="text-gray-600 dark:text-gray-400">Try adjusting your search terms or filters</p>
            </div>

            <!-- Recipe Modal -->
            <div x-show="showRecipeModal" 
                 @click="showRecipeModal = false"
                 class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div @click.stop 
                     class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl" 
                     style="height: 80vh">
                    
                    <!-- Modal Header -->
                    <div class="bg-white dark:bg-gray-800 p-6 border-b border-gray-200 dark:border-gray-600 rounded-t-lg">
                        <div class="flex items-center justify-between">
                            <h2 x-show="selectedRecipe" class="text-2xl font-bold text-gray-800 dark:text-gray-100" x-text="selectedRecipe?.title"></h2>
                            <button @click="showRecipeModal = false" 
                                    class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-2xl">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Modal Content -->
                    <div class="bg-gray-50 dark:bg-gray-900 p-6 overflow-y-scroll" 
                         style="height: calc(80vh - 120px)">
                        <template x-if="selectedRecipe">
                            <div class="space-y-6">
                                <!-- Recipe Info -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div x-show="selectedRecipe.cuisine" class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Cuisine</div>
                                        <div class="font-semibold text-gray-800 dark:text-gray-200" x-text="selectedRecipe.cuisine"></div>
                                    </div>
                                    <div x-show="selectedRecipe.preparationTime" class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Prep Time</div>
                                        <div class="font-semibold text-gray-800 dark:text-gray-200" x-text="selectedRecipe.preparationTime"></div>
                                    </div>
                                    <div x-show="selectedRecipe.servings" class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Servings</div>
                                        <div class="font-semibold text-gray-800 dark:text-gray-200" x-text="selectedRecipe.servings"></div>
                                    </div>
                                    <div x-show="selectedRecipe.dateAdded" class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Date Added</div>
                                        <div class="font-semibold text-gray-800 dark:text-gray-200" x-text="selectedRecipe.dateAdded"></div>
                                    </div>
                                </div>

                                <!-- Description -->
                                <div x-show="selectedRecipe.description" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Description</h3>
                                    <p class="text-gray-600 dark:text-gray-400" x-text="selectedRecipe.description"></p>
                                </div>

                                <!-- Dietary Information -->
                                <div x-show="selectedRecipe.dietaryInfo && selectedRecipe.dietaryInfo.length > 0" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                                        <i class="bi bi-shield-check mr-2"></i>Dietary Information
                                    </h3>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="dietary in selectedRecipe.dietaryInfo" :key="dietary">
                                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border border-yellow-300 dark:border-yellow-700" x-text="dietary"></span>
                                        </template>
                                    </div>
                                </div>

                                <!-- Ingredients -->
                                <div x-show="selectedRecipe.ingredients" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                                        <i class="bi bi-list-ul mr-2"></i>Ingredients
                                    </h3>
                                    <div x-html="selectedRecipe.ingredients" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                </div>

                                <!-- Steps -->
                                <div x-show="selectedRecipe.steps" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">
                                        <i class="bi bi-list-ol mr-2"></i>Instructions
                                    </h3>
                                    <div x-html="selectedRecipe.steps" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                </div>

                                <!-- Additional Info -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div x-show="selectedRecipe.servingGuidelines" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Serving Guidelines</h3>
                                        <div x-html="selectedRecipe.servingGuidelines" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                    </div>
                                    <div x-show="selectedRecipe.notes" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Notes</h3>
                                        <div x-html="selectedRecipe.notes" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                    </div>
                                </div>

                                <!-- Source -->
                                <div x-show="selectedRecipe.source" class="bg-white dark:bg-gray-800 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Source</h3>
                                    <div x-html="selectedRecipe.source" class="text-gray-600 dark:text-gray-400 max-w-none"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function cookbookApp() {
            return {
                // === STATE ===
                recipes: [],
                searchTerm: '',
                activeFilter: 'all',
                loading: true,
                darkMode: false,
                viewMode: 'card', // 'card' or 'list'
                showRecipeModal: false,
                selectedRecipe: null,
                groupBy: 'none', // 'none', 'cuisine', 'meal', 'course', 'type'
                sortBy: 'alphabetical', // 'alphabetical', 'date-added'

                // === COMPUTED PROPERTIES ===
                get filteredRecipes() {
                    let filtered = this.recipes;
                    
                    // Apply search filter
                    if (this.searchTerm) {
                        const searchLower = this.searchTerm.toLowerCase();
                        filtered = filtered.filter(recipe => 
                            recipe.title.toLowerCase().includes(searchLower) ||
                            recipe.description.toLowerCase().includes(searchLower) ||
                            (recipe.cuisine && recipe.cuisine.toLowerCase().includes(searchLower)) ||
                            (recipe.ingredients && recipe.ingredients.toLowerCase().includes(searchLower)) ||
                            (recipe.dietaryInfo && recipe.dietaryInfo.some(info => 
                                info.toLowerCase().includes(searchLower)
                            ))
                        );
                    }
                    
                    // Apply category filter
                    if (this.activeFilter !== 'all') {
                        filtered = filtered.filter(recipe => {
                            switch (this.activeFilter) {
                                case 'appetizer':
                                    return recipe.courses && recipe.courses.some(course => 
                                        course.toLowerCase().includes('appetizer') || 
                                        course.toLowerCase().includes('side')
                                    );
                                case 'main':
                                    return recipe.courses && recipe.courses.some(course => 
                                        course.toLowerCase().includes('main') || 
                                        course.toLowerCase().includes('entree')
                                    );
                                case 'quick':
                                    return recipe.preparationTime && 
                                           this.extractMinutes(recipe.preparationTime) <= 30;
                                case 'gluten-free':
                                    return recipe.dietaryInfo && recipe.dietaryInfo.some(info => 
                                        info.toLowerCase().includes('gluten-free')
                                    ) && !recipe.dietaryInfo.some(info => 
                                        info.toLowerCase().includes('may contain gluten') || 
                                        info.toLowerCase().includes('contains gluten')
                                    );
                                case 'nut-free':
                                    return recipe.dietaryInfo && !recipe.dietaryInfo.some(info => 
                                        info.toLowerCase().includes('nuts') || 
                                        info.toLowerCase().includes('cashew') ||
                                        info.toLowerCase().includes('almond') ||
                                        info.toLowerCase().includes('peanut')
                                    );
                                case 'soy-free':
                                    return recipe.dietaryInfo && !recipe.dietaryInfo.some(info => 
                                        info.toLowerCase().includes('soy')
                                    );
                                default:
                                    return true;
                            }
                        });
                    }
                    
                    // Apply sorting
                    filtered = this.sortRecipes(filtered);
                    
                    return filtered;
                },

                get groupedRecipes() {
                    const recipes = this.filteredRecipes;
                    
                    if (this.groupBy === 'none') {
                        return [{ group: null, recipes: recipes }];
                    }
                    
                    const groups = {};
                    
                    recipes.forEach(recipe => {
                        let groupKeys = [];
                        
                        switch (this.groupBy) {
                            case 'cuisine':
                                groupKeys = [recipe.cuisine || 'Other'];
                                break;
                            case 'meal':
                                groupKeys = [recipe.meal || 'Other'];
                                break;
                            case 'course':
                                groupKeys = recipe.courses && recipe.courses.length > 0 
                                    ? recipe.courses 
                                    : ['Other'];
                                break;
                            case 'type':
                                groupKeys = [recipe.type || 'Other'];
                                break;
                        }
                        
                        groupKeys.forEach(key => {
                            if (!groups[key]) {
                                groups[key] = [];
                            }
                            groups[key].push(recipe);
                        });
                    });
                    
                    // Convert to array and sort group names
                    return Object.keys(groups)
                        .sort((a, b) => a.localeCompare(b))
                        .map(group => ({
                            group: group,
                            recipes: groups[group]
                        }));
                },

                // === METHODS ===
                async init() {
                    // Load dark mode preference
                    const savedDarkMode = localStorage.getItem('cookbook-darkMode');
                    this.darkMode = savedDarkMode === 'true';
                    this.updateDarkMode();
                    
                    // Load view mode preference
                    const savedViewMode = localStorage.getItem('cookbook-viewMode');
                    this.viewMode = savedViewMode || 'card';
                    
                    // Load grouping preference
                    const savedGroupBy = localStorage.getItem('cookbook-groupBy');
                    this.groupBy = savedGroupBy || 'none';
                    
                    // Load sorting preference
                    const savedSortBy = localStorage.getItem('cookbook-sortBy');
                    this.sortBy = savedSortBy || 'alphabetical';
                    
                    // Load recipes
                    await this.loadRecipes();
                },

                async loadRecipes() {
                    this.loading = true;
                    try {
                        // Load recipe file list from manifest
                        let recipeFiles = [];
                        try {
                            const manifestResponse = await fetch('recipes.json');
                            if (manifestResponse.ok) {
                                recipeFiles = await manifestResponse.json();
                            }
                        } catch (error) {
                            console.warn('Could not load recipe manifest, using fallback list:', error);
                            // Fallback to known recipe files if manifest fails
                            recipeFiles = [
                                'hummus-moosewood.md',
                                'chili-fire-roasted.md',
                                'peanut-sesame-noodles.md'
                            ];
                        }
                        
                        const recipePromises = recipeFiles.map(async (filename) => {
                            try {
                                const response = await fetch(`recipes/${filename}`);
                                if (response.ok) {
                                    const content = await response.text();
                                    return this.parseRecipe(content, filename);
                                }
                                return null;
                            } catch (error) {
                                console.error(`Error loading ${filename}:`, error);
                                return null;
                            }
                        });
                        
                        const results = await Promise.all(recipePromises);
                        this.recipes = results.filter(recipe => recipe !== null);
                        
                        // If no recipes loaded from files, add sample data
                        if (this.recipes.length === 0) {
                            this.addSampleRecipes();
                        }
                        
                    } catch (error) {
                        console.error('Error loading recipes:', error);
                        // Add sample data if loading fails
                        this.addSampleRecipes();
                    }
                    this.loading = false;
                },

                parseRecipe(content, filename) {
                    const lines = content.split('\n');
                    const recipe = {
                        id: filename.replace('.md', ''),
                        title: '',
                        description: '',
                        dietaryInfo: [],
                        cuisine: '',
                        meal: '',
                        courses: [],
                        type: '',
                        preparationTime: '',
                        servings: '',
                        ingredients: '',
                        steps: '',
                        servingGuidelines: '',
                        notes: '',
                        source: '',
                        dateAdded: ''
                    };

                    let currentSection = '';
                    let sectionContent = [];

                    for (let line of lines) {
                        line = line.trim();
                        
                        // Handle title
                        if (line.startsWith('# ') && !recipe.title) {
                            recipe.title = line.substring(2).trim();
                            continue;
                        }

                        // Handle sections
                        if (line.startsWith('## ')) {
                            // Save previous section
                            if (currentSection && sectionContent.length > 0) {
                                this.assignSectionContent(recipe, currentSection, sectionContent);
                            }
                            
                            currentSection = line.substring(3).trim().toLowerCase();
                            sectionContent = [];
                            continue;
                        }

                        // Collect content for current section
                        if (currentSection && line) {
                            sectionContent.push(line);
                        }
                    }

                    // Handle final section
                    if (currentSection && sectionContent.length > 0) {
                        this.assignSectionContent(recipe, currentSection, sectionContent);
                    }

                    return recipe;
                },

                assignSectionContent(recipe, section, content) {
                    const contentText = content.join('\n');
                    
                    switch (section) {
                        case 'description':
                            recipe.description = contentText;
                            break;
                        case 'date added':
                            recipe.dateAdded = contentText.replace(/^-\s*/, '').trim();
                            break;
                        case 'dietary information':
                            recipe.dietaryInfo = contentText.split('\n').map(d => d.replace(/^-\s*/, '').trim()).filter(d => d);
                            break;
                        case 'cuisine':
                            recipe.cuisine = contentText.replace(/^-\s*/, '');
                            break;
                        case 'meal':
                            recipe.meal = contentText.replace(/^-\s*/, '');
                            break;
                        case 'course':
                            recipe.courses = contentText.split('\n').map(c => c.replace(/^-\s*/, '').trim()).filter(c => c);
                            break;
                        case 'type':
                            recipe.type = contentText.replace(/^-\s*/, '');
                            break;
                        case 'preparation time':
                            recipe.preparationTime = contentText.replace(/^-\s*/, '');
                            break;
                        case 'servings':
                            recipe.servings = contentText.replace(/^-\s*/, '');
                            break;
                        case 'ingredients':
                            recipe.ingredients = this.markdownToHtml(contentText);
                            break;
                        case 'steps':
                            recipe.steps = this.markdownToHtml(contentText);
                            break;
                        case 'serving guidelines':
                            recipe.servingGuidelines = this.markdownToHtml(contentText);
                            break;
                        case 'notes':
                            recipe.notes = this.markdownToHtml(contentText);
                            break;
                        case 'source / inspiration':
                            recipe.source = this.markdownToHtml(contentText);
                            break;
                    }
                },

                markdownToHtml(text) {
                    return text
                        .replace(/^### (.*$)/gm, '<h4 class="font-semibold text-gray-800 dark:text-gray-200 mt-4 mb-2">$1</h4>')
                        .replace(/^- (.*$)/gm, '<li class="mb-1">$1</li>')
                        .replace(/^(\d+)\. (.*$)/gm, '<li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">$1.</span> $2</li>')
                        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" class="text-blue-600 dark:text-blue-400 underline hover:text-blue-800 dark:hover:text-blue-200" target="_blank" rel="noopener">$1</a>')
                        .replace(/(?:^- .*$\n?)+/gm, (match) => `<ul class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-200">${match}</ul>`)
                        .replace(/(?:^\d+\. .*$\n?)+/gm, (match) => `<ol class="space-y-2 text-gray-700 dark:text-gray-200">${match}</ol>`);
                },

                addSampleRecipes() {
                    this.recipes = [
                        {
                            id: 'sample-hummus',
                            title: 'Classic Hummus',
                            description: 'A creamy, delicious chickpea dip perfect for camping.',
                            dietaryInfo: ['Vegan', 'Gluten-Free', 'Contains Sesame'],
                            cuisine: 'Middle Eastern',
                            courses: ['Appetizer', 'Side'],
                            preparationTime: '15 minutes',
                            servings: '4 servings',
                            ingredients: '<ul class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-200"><li class="mb-1">1 can chickpeas</li><li class="mb-1">2 cloves garlic</li><li class="mb-1">2 tbsp tahini</li><li class="mb-1">Lemon juice</li></ul>',
                            steps: '<ol class="space-y-2 text-gray-700 dark:text-gray-200"><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">1.</span> Drain chickpeas</li><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">2.</span> Blend all ingredients</li><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">3.</span> Serve with pita</li></ol>'
                        },
                        {
                            id: 'sample-chili',
                            title: 'Campfire Black Bean Chili',
                            description: 'A hearty, warming chili perfect for cold camping nights.',
                            dietaryInfo: ['Vegan', 'Gluten-Free'],
                            cuisine: 'American',
                            courses: ['Main'],
                            preparationTime: '45 minutes',
                            servings: '6 servings',
                            ingredients: '<ul class="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-200"><li class="mb-1">2 cans black beans</li><li class="mb-1">1 can diced tomatoes</li><li class="mb-1">Chili spices</li><li class="mb-1">Vegetables</li></ul>',
                            steps: '<ol class="space-y-2 text-gray-700 dark:text-gray-200"><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">1.</span> Sauté vegetables</li><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">2.</span> Add beans and tomatoes</li><li class="mb-2"><span class="font-medium text-green-600 dark:text-green-400">3.</span> Simmer 30 minutes</li></ol>'
                        }
                    ];
                },

                extractMinutes(timeString) {
                    const match = timeString.match(/(\d+)\s*min/i);
                    return match ? parseInt(match[1]) : 999;
                },

                sortRecipes(recipes) {
                    const sorted = [...recipes];
                    
                    switch (this.sortBy) {
                        case 'alphabetical':
                            return sorted.sort((a, b) => a.title.localeCompare(b.title));
                        case 'date-added':
                            return sorted.sort((a, b) => {
                                // Parse dates in YYYY.MM.DD format
                                const dateA = a.dateAdded ? new Date(a.dateAdded.replace(/\./g, '-')) : new Date(0);
                                const dateB = b.dateAdded ? new Date(b.dateAdded.replace(/\./g, '-')) : new Date(0);
                                return dateB - dateA; // Most recent first
                            });
                        default:
                            return sorted;
                    }
                },

                openRecipeModal(recipe) {
                    this.selectedRecipe = recipe;
                    this.showRecipeModal = true;
                },

                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    this.updateDarkMode();
                    localStorage.setItem('cookbook-darkMode', this.darkMode.toString());
                },

                toggleViewMode() {
                    this.viewMode = this.viewMode === 'card' ? 'list' : 'card';
                    localStorage.setItem('cookbook-viewMode', this.viewMode);
                },

                setGroupBy(value) {
                    this.groupBy = value;
                    localStorage.setItem('cookbook-groupBy', value);
                },

                setSortBy(value) {
                    this.sortBy = value;
                    localStorage.setItem('cookbook-sortBy', value);
                },

                updateDarkMode() {
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }
            }
        }
    </script>
</body>
</html>